name: Deploy to Truehost domain for akountinprofessionals.co.uk via SFTP

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install dependencies
      run: npm install

    - name: Build Vite project
      run: npm run build

    - name: Copy .htaccess to dist folder
      run: |
        if [ -f public/.htaccess ]; then
          cp public/.htaccess dist/
        elif [ -f .htaccess ]; then
          cp .htaccess dist/
        else
          echo "Creating .htaccess in dist folder"
          cat > dist/.htaccess << 'EOF'
        <IfModule mod_rewrite.c>
          RewriteEngine On
          RewriteBase /
          RewriteRule ^index\.html$ - [L]
          RewriteCond %{REQUEST_FILENAME} !-f
          RewriteCond %{REQUEST_FILENAME} !-d
          RewriteCond %{REQUEST_FILENAME} !-l
          RewriteRule . /index.html [L]
        </IfModule>
        EOF
        fi

    - name: Upload to server via SFTP
      uses: wlixcc/SFTP-Deploy-Action@v1.2.4
      with:
        server: ${{ secrets.SFTP_SERVER }}
        port: ${{ secrets.SFTP_PORT }}
        username: ${{ secrets.SFTP_USERNAME }}
        password: ${{ secrets.SFTP_PASSWORD }}
        local_path: "dist/*"
        remote_path: "/home/nwitpnms/public_html"
        sftp_only: true




